{% extends "base_new.html" %}

{% block title %}Manage Sites - Multi-Site Inventory{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-building me-2"></i>
                    Manage Sites
                </h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSiteModal">
                    <i class="fas fa-plus me-2"></i>Add New Site
                </button>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-list me-2"></i>
                        Construction Sites
                    </h5>
                </div>
                <div class="card-body">
                    {% if sites %}
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Site Name</th>
                                        <th>Location</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for site in sites %}
                                    <tr>
                                        <td>
                                            <strong>{{ site.name }}</strong><br>
                                            <small class="text-muted">{{ site.code }}</small>
                                        </td>
                                        <td>{{ site.location or 'N/A' }}</td>
                                        <td>
                                            <span class="badge {% if site.is_active %}bg-success{% else %}bg-danger{% endif %}">
                                                {{ 'Active' if site.is_active else 'Inactive' }}
                                            </span>
                                        </td>
                                        <td>{{ site.created_at.strftime('%m/%d/%Y') }}</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary" 
                                                    onclick="editSite({{ site.id }}, '{{ site.name }}', '{{ site.code }}', '{{ site.location or '' }}', {{ 'true' if site.is_active else 'false' }})">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-info" 
                                                    onclick="viewSiteDetails({{ site.id }})">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-building fa-3x text-muted mb-3"></i>
                            <h5>No sites found</h5>
                            <p class="text-muted">Click "Add New Site" to create your first construction site.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Site Modal -->
<div class="modal fade" id="addSiteModal" tabindex="-1" aria-labelledby="addSiteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addSiteModalLabel">
                    <i class="fas fa-plus me-2"></i>Add New Site
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('add_site') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="siteName" class="form-label">Site Name</label>
                        <input type="text" class="form-control" id="siteName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="siteCode" class="form-label">Site Code</label>
                        <input type="text" class="form-control" id="siteCode" name="code" required>
                    </div>
                    <div class="mb-3">
                        <label for="siteLocation" class="form-label">Location</label>
                        <input type="text" class="form-control" id="siteLocation" name="location">
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="1" id="siteActive" name="is_active" checked>
                            <label class="form-check-label" for="siteActive">
                                Active Site
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Site</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Site Modal -->
<div class="modal fade" id="editSiteModal" tabindex="-1" aria-labelledby="editSiteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editSiteModalLabel">
                    <i class="fas fa-edit me-2"></i>Edit Site
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('edit_site') }}">
                <div class="modal-body">
                    <input type="hidden" id="editSiteId" name="site_id">
                    <div class="mb-3">
                        <label for="editSiteName" class="form-label">Site Name</label>
                        <input type="text" class="form-control" id="editSiteName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editSiteCode" class="form-label">Site Code</label>
                        <input type="text" class="form-control" id="editSiteCode" name="code" required>
                    </div>
                    <div class="mb-3">
                        <label for="editSiteLocation" class="form-label">Location</label>
                        <input type="text" class="form-control" id="editSiteLocation" name="location">
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="1" id="editSiteActive" name="is_active">
                            <label class="form-check-label" for="editSiteActive">
                                Active Site
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Site</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function editSite(id, name, code, location, isActive) {
    document.getElementById('editSiteId').value = id;
    document.getElementById('editSiteName').value = name;
    document.getElementById('editSiteCode').value = code;
    document.getElementById('editSiteLocation').value = location || '';
    document.getElementById('editSiteActive').checked = isActive;
    
    const modal = new bootstrap.Modal(document.getElementById('editSiteModal'));
    modal.show();
}

function viewSiteDetails(siteId) {
    // This would show detailed information about the site
    window.location.href = `/site_details/${siteId}`;
}
</script>
{% endblock %}